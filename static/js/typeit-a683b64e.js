const ne=e=>Array.isArray(e),le=e=>ne(e)?e:[e];let pe=function(e){let t=function(f){return le(f).forEach(w=>{var L;return b.set(Symbol((L=w.char)==null?void 0:L.innerText),o({...w}))}),this},n=()=>h().filter(f=>f.typeable),i=function(f,w){let L=[...b.keys()];b.set(L[f],o(w))},o=f=>(f.shouldPauseCursor=function(){return!!(this.typeable||this.cursorable||this.deletable)},f),a=function(){b.forEach(f=>delete f.done)},y=function(){b=new Map,t(e)},d=()=>b,h=()=>Array.from(b.values()),m=f=>b.delete(f),_=(f=!1)=>f?h():h().filter(w=>!w.done),T=(f,w=!1)=>w?b.delete(f):b.get(f).done=!0,b=new Map;return t(e),{add:t,set:i,wipe:y,reset:a,destroy:m,done:T,getItems:_,getQueue:d,getTypeable:n}};const ie=e=>Array.from(e),W=e=>document.createTextNode(e);let j=e=>([...e.childNodes].forEach(t=>{if(t.nodeValue){[...t.nodeValue].forEach(n=>{t.parentNode.insertBefore(W(n),t)}),t.remove();return}j(t)}),e);const ae=e=>{let t=document.implementation.createHTMLDocument();return t.body.innerHTML=e,j(t.body)},se="data-typeit-id",A="ti-cursor",be="END",ge={started:!1,completed:!1,frozen:!1,destroyed:!1},x={breakLines:!0,cursor:{autoPause:!0,autoPauseDelay:500,animation:{frames:[0,0,1].map(e=>({opacity:e})),options:{iterations:1/0,easing:"steps(2, start)",fill:"forwards"}}},cursorChar:"|",cursorSpeed:1e3,deleteSpeed:null,html:!0,lifeLike:!0,loop:!1,loopDelay:750,nextStringDelay:750,speed:100,startDelay:250,startDelete:!1,strings:[],waitUntilVisible:!1,beforeString:()=>{},afterString:()=>{},beforeStep:()=>{},afterStep:()=>{},afterComplete:()=>{}},Se=`[${se}]:before {content: '.'; display: inline-block; width: 0; visibility: hidden;}`;function oe(e,t=!1,n=!1){let i=e.querySelector(`.${A}`),o=document.createTreeWalker(e,NodeFilter.SHOW_ALL,{acceptNode:d=>{var h,m;if(i&&n){if((h=d.classList)!=null&&h.contains(A))return NodeFilter.FILTER_ACCEPT;if(i.contains(d))return NodeFilter.FILTER_REJECT}return(m=d.classList)!=null&&m.contains(A)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),a,y=[];for(;a=o.nextNode();)a.originalParent||(a.originalParent=a.parentNode),y.push(a);return t?y.reverse():y}function Te(e){return oe(ae(e))}function we(e,t=!0){return t?Te(e):ie(e).map(W)}const $=e=>document.createElement(e),ue=(e,t="")=>{let n=$("style");n.id=t,n.appendChild(W(e)),document.head.appendChild(n)},Y=e=>(ne(e)||(e=[e/2,e/2]),e),Z=(e,t)=>Math.abs(Math.random()*(e+t-(e-t))+(e-t));let ee=e=>e/2;function Ee(e){let{speed:t,deleteSpeed:n,lifeLike:i}=e;return n=n!==null?n:t/3,i?[Z(t,ee(t)),Z(n,ee(n))]:[t,n]}const Ce=e=>(e.forEach(clearTimeout),[]),_e=()=>Math.random().toString().substring(2,9),J=e=>"value"in e;let Pe=e=>J(e)?ie(e.value):oe(e,!0).filter(t=>!(t.childNodes.length>0));const Ie=(e,t)=>{new IntersectionObserver((i,o)=>{i.forEach(a=>{a.isIntersecting&&(t(),o.unobserve(e))})},{threshold:1}).observe(e)};let v=e=>typeof e=="function"?e():e;const de=e=>Number.isInteger(e);let X=(e,t=document,n=!1)=>t[`querySelector${n?"All":""}`](e),Ne=e=>/body/i.test(e==null?void 0:e.tagName),Ae=(e,t)=>{if(J(e)){e.value=`${e.value}${t.textContent}`;return}t.innerHTML="";let n=Ne(t.originalParent)?e:t.originalParent||e;n.insertBefore(t,X("."+A,n)||null)},Le=(e,t,n)=>Math.min(Math.max(t+e,0),n.length);const k=(e,t)=>Object.assign({},e,t),De=(e,t)=>{if(!e)return;let n=e.parentNode;(n.childNodes.length>1||n.isSameNode(t)?e:n).remove()},ve=(e,t,n)=>{let i=t[n-1],o=X(`.${A}`,e);e=(i==null?void 0:i.parentNode)||e,e.insertBefore(o,i||null)};function xe(e){return typeof e=="string"?X(e):e}const ke=e=>/<(.+)>(.*?)<\/(.+)>/.test(e.outerHTML);let Me=(e,t,n)=>new Promise(i=>{let o=async()=>{await e(),i()};n.push(setTimeout(o,t||0))}),Re={"font-family":"","font-weight":"","font-size":"","font-style":"","line-height":"",color:"",transform:"translateX(-.125em)"},Fe=(e,t)=>{let i=`${`[${se}='${e}']`} .${A}`,o=getComputedStyle(t),a=Object.entries(Re).reduce((y,[d,h])=>`${y} ${d}: var(--ti-cursor-${d}, ${h||o[d]});`,"");ue(`${i} { display: inline-block; width: 0; ${a} }`,e)};const H=(e,t)=>new Array(t).fill(e),te=({queueItems:e,selector:t,cursorPosition:n,to:i})=>{if(de(t))return t*-1;let o=new RegExp(be,"i").test(i),a=t?[...e].reverse().findIndex(({char:d})=>{let h=d.parentElement,m=h.matches(t);return o&&m?!0:m&&h.firstChild.isSameNode(d)}):-1;a<0&&(a=o?0:e.length-1);let y=o?0:1;return a-n+y};let Q=e=>new Promise(t=>{requestAnimationFrame(async()=>{t(await e())})}),fe=e=>e==null?void 0:e.getAnimations().find(t=>t.id===e.dataset.tiAnimationId),ce=({cursor:e,frames:t,options:n})=>{let i=e.animate(t,n);return i.pause(),i.id=e.dataset.tiAnimationId,Q(()=>{Q(()=>{i.play()})}),i},He=({cursor:e,options:t,cursorOptions:n})=>{if(!e||!n)return;let i=fe(e),o;i&&(t.delay=i.effect.getComputedTiming().delay,o=i.currentTime,i.cancel());let a=ce({cursor:e,frames:n.animation.frames,options:t});return o&&(a.currentTime=o),a},re=e=>{var t;return(t=e.func)==null?void 0:t.call(null)},$e=async({index:e,queueItems:t,wait:n,cursor:i,cursorOptions:o})=>{let a=t[e][1],y=[],d=e,h=a,m=()=>h&&!h.delay,_=a.shouldPauseCursor()&&o.autoPause;for(;m();)y.push(h),m()&&d++,h=t[d]?t[d][1]:null;if(y.length)return await Q(async()=>{for(let f of y)await re(f)}),d-1;let T=fe(i),b;return T&&(b={...T.effect.getComputedTiming(),delay:_?o.autoPauseDelay:0}),await n(async()=>{T&&_&&T.cancel(),await Q(()=>{re(a)})},a.delay),await He({cursor:i,options:b,cursorOptions:o}),e},Qe=e=>{var t,n;if(typeof e=="object"){let i={},{frames:o,options:a}=x.cursor.animation;return i.animation=e.animation||{},i.animation.frames=((t=e.animation)==null?void 0:t.frames)||o,i.animation.options=k(a,((n=e.animation)==null?void 0:n.options)||{}),i.autoPause=e.autoPause??x.cursor.autoPause,i.autoPauseDelay=e.autoPauseDelay||x.cursor.autoPauseDelay,i}return e===!0?x.cursor:e};const Be=function(e,t={}){let n=async(r,l,u=!1)=>{E.frozen&&await new Promise(c=>{this.unfreeze=()=>{E.frozen=!1,c()}}),u||await s.beforeStep(this),await Me(r,l,q),u||await s.afterStep(this)},i=(r,l)=>$e({index:r,queueItems:l,wait:n,cursor:N,cursorOptions:s.cursor}),o=r=>De(r,p),a=()=>J(p),y=(r=0)=>Ee(s)[r],d=()=>Pe(p),h=(r={})=>{let l=r.delay;l&&g.add({delay:l})},m=(r,l)=>(g.add(r),h(l),this),_=()=>K??D,T=(r={})=>[{func:()=>R(r)},{func:()=>R(s)}],b=r=>{let l=s.nextStringDelay;g.add([{delay:l[0]},...r,{delay:l[1]}])},f=()=>{if(a())return;let r=$("span");return r.className=A,O?(r.innerHTML=ae(s.cursorChar).innerHTML,r):(r.style.visibility="hidden",r)},w=async()=>{if(!a()&&N&&p.appendChild(N),O){Fe(U,p),N.dataset.tiAnimationId=U;let{animation:r}=s.cursor,{frames:l,options:u}=r;ce({frames:l,cursor:N,options:{duration:s.cursorSpeed,...u}})}},L=()=>{let r=s.strings.filter(l=>!!l);r.forEach((l,u)=>{if(this.type(l),u+1===r.length)return;let c=s.breakLines?[{func:()=>B($("BR")),typeable:!0}]:H({func:F,delay:y(1)},g.getTypeable().length);b(c)})},ye=async r=>{let l=_();l&&await G({value:l});let u=d().map(c=>[Symbol(),{func:F,delay:y(1),deletable:!0,shouldPauseCursor:()=>!0}]);for(let c=0;c<u.length;c++)await i(c,u);g.reset(),g.set(0,{delay:r})},me=r=>{let l=p.innerHTML;return l?(p.innerHTML="",s.startDelete?(p.innerHTML=l,j(p),b(H({func:F,delay:y(1),deletable:!0},d().length)),r):l.replace(/<!--(.+?)-->/g,"").trim().split(/<br(?:\s*?)(?:\/)?>/).concat(r)):r},M=async(r=!0)=>{E.started=!0;let l=u=>{g.done(u,!r)};try{let u=[...g.getQueue()];for(let S=0;S<u.length;S++){let[P,C]=u[S];if(!C.done){if(!C.deletable||C.deletable&&d().length){let I=await i(S,u);Array(I-S).fill(S+1).map((z,V)=>z+V).forEach(z=>{let[V]=u[z];l(V)}),S=I}l(P)}}if(!r)return this;if(E.completed=!0,await s.afterComplete(this),!s.loop)throw"";let c=s.loopDelay;n(async()=>{await ye(c[0]),M()},c[1])}catch{}return this},G=async r=>{D=Le(r,D,d()),ve(p,d(),D)},B=r=>Ae(p,r),R=async r=>s=k(s,r),he=async()=>{if(a()){p.value="";return}d().forEach(o)},F=()=>{let r=d();r.length&&(a()?p.value=p.value.slice(0,-1):o(r[D]))};this.break=function(r){return m({func:()=>B($("BR")),typeable:!0},r)},this.delete=function(r=null,l={}){r=v(r);let u=T(l),c=r,{instant:S,to:P}=l,C=g.getTypeable(),I=(()=>c===null?C.length:de(c)?c:te({queueItems:C,selector:c,cursorPosition:_(),to:P}))();return m([u[0],...H({func:F,delay:S?0:y(1),deletable:!0},I),u[1]],l)},this.empty=function(r={}){return m({func:he},r)},this.exec=function(r,l={}){let u=T(l);return m([u[0],{func:()=>r(this)},u[1]],l)},this.move=function(r,l={}){r=v(r);let u=T(l),{instant:c,to:S}=l,P=te({queueItems:g.getTypeable(),selector:r===null?"":r,to:S,cursorPosition:_()}),C=P<0?-1:1;return K=_()+P,m([u[0],...H({func:()=>G(C),delay:c?0:y(),cursorable:!0},Math.abs(P)),u[1]],l)},this.options=function(r,l={}){return r=v(r),R(r),m({},l)},this.pause=function(r,l={}){return m({delay:v(r)},l)},this.type=function(r,l={}){r=v(r);let{instant:u}=l,c=T(l),P=we(r,s.html).map(I=>({func:()=>B(I),char:I,delay:u||ke(I)?0:y(),typeable:I.nodeType===Node.TEXT_NODE})),C=[c[0],{func:async()=>await s.beforeString(r,this)},...P,{func:async()=>await s.afterString(r,this)},c[1]];return m(C,l)},this.is=function(r){return E[r]},this.destroy=function(r=!0){q=Ce(q),v(r)&&N&&o(N),E.destroyed=!0},this.freeze=function(){E.frozen=!0},this.unfreeze=()=>{},this.reset=function(r){!this.is("destroyed")&&this.destroy(),r?(g.wipe(),r(this)):g.reset(),D=0;for(let l in E)E[l]=!1;return p[a()?"value":"innerHTML"]="",this},this.go=function(){return E.started?this:(w(),s.waitUntilVisible?(Ie(p,M.bind(this)),this):(M(),this))},this.flush=function(r=()=>{}){return w(),M(!1).then(r),this},this.getQueue=()=>g,this.getOptions=()=>s,this.updateOptions=r=>R(r),this.getElement=()=>p;let p=xe(e),q=[],D=0,K=null,E=k({},ge);t.cursor=Qe(t.cursor??x.cursor);let s=k(x,t);s=k(s,{html:!a()&&s.html,nextStringDelay:Y(s.nextStringDelay),loopDelay:Y(s.loopDelay)});let U=_e(),g=pe([{delay:s.startDelay}]);p.dataset.typeitId=U,ue(Se);let O=!!s.cursor&&!a(),N=f();s.strings=me(le(s.strings)),s.strings.length&&L()};export{Be as T};
